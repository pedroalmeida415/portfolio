'use client'

import localFont from 'next/font/local'
import gsap from 'gsap'
import '@/global.css'
import { ScrollTrigger } from 'gsap/ScrollTrigger'
import Script from 'next/script'
import { Header } from './Header'
import dynamic from 'next/dynamic'

const neue_montreal = localFont({
  src: './assets/fonts/neue-montreal/PPNeueMontreal-Variable.woff2',
  display: 'swap',
  variable: '--font-neue-montreal-variable',
  fallback: ['sans-serif'],
  declarations: [
    {
      prop: 'font-variation-settings',
      value: '"wght" 450',
    },
  ],
})

const Layout = dynamic(() => import('@/components/dom/Layout').then((mod) => mod.Layout), { ssr: false })

export default function RootLayout({ children }) {
  return (
    <html lang='en' className={`${neue_montreal.variable}`}>
      {/*
        <head /> will contain the components returned by the nearest parent
        head.tsx. Find out more at https://beta.nextjs.org/docs/api-reference/file-conventions/head
      */}
      <head />
      <body>
        <Header />
        <div id='smooth-wrapper'>
          <div id='smooth-content'>
            <Layout>{children}</Layout>
          </div>
        </div>
        <Script
          id='scroll-smoother'
          onReady={() => {
            requestIdleCallback(
              () => {
              gsap.registerPlugin(ScrollTrigger, window.ScrollSmoother)

              window.ScrollSmoother.create({
                smooth: 0.8,
                smoothTouch: 0.1,
              })
              },
              {
                timeout: 1000,
              },
            )
          }}
        >
          {`!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).window=e.window||{})}(this,function(e){"use strict";function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(){return"undefined"!=typeof window}function n(){return l||r()&&(l=window.gsap)&&l.registerPlugin&&l}function o(e){return $.maxScroll(e||u)}var i,s,a,l,c,u,f,d,p,g,h,$,v,m,y,_,b,w,S=(T.register=function e(t){return c||(l=t||n(),r()&&window.document&&(u=window,d=(f=document).documentElement,p=f.body),l&&(g=l.utils.toArray,h=l.utils.clamp,m=l.parseEase("expo"),b=l.core.context||function(){},$=l.core.globals().ScrollTrigger,l.core.globals("ScrollSmoother",T),p&&$&&(w=l.delayedCall(.2,function(){return $.isRefreshing||v&&v.refresh()}).pause(),y=$.core._getVelocityProp,_=$.core._inputObserver,T.refresh=$.refresh,c=1))),c},i=T,s=[{key:"progress",get:function e(){return this.scrollTrigger?this.scrollTrigger.animation._time/100:0}}],t(i.prototype,s),a&&t(i,a),T);function T(e){var t=this;function r(){return ec.update(-es)}function n(){return B.style.overflow="visible"}function i(e){e.update();var t=e.getTween();t&&(t.pause(),t._time=t._dur,t._tTime=t._tDur),j=!1,e.animation.progress(e.progress,!0)}function s(e,t){(e!==es&&!O||t)&&(ee&&(e=Math.round(e)),eo&&(B.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+e+", 0, 1)",B._gsap.y=e+"px"),ea=e-es,es=e,$.isUpdating||T.isRefreshing||$.update())}function a(e){return arguments.length?(e<0&&(e=0),eu.y=-e,j=!0,O?es=-e:s(-e),$.isRefreshing?L.update():en(e/ei),this):-es}function S(e){H.scrollTop=0,e.target.contains&&e.target.contains(H)||X&&!1===X(t,e)||($.isInViewport(e.target)||e.target===K||t.scrollTo(e.target,!1,"center center"),K=e.target)}function C(e,t){if(e<t.start)return e;var r=isNaN(t.ratio)?1:t.ratio,n=t.end-t.start,i=e-t.start,s=t.offset||0,a=t.pins||[],l=a.offset||0,c=t._startClamp&&t.start<=0||t.pins&&t.pins.offset?0:t._endClamp&&t.end===o()?1:.5;return a.forEach(function(t){n-=t.distance,t.nativeStart<=e&&(i-=t.distance)}),l&&(i*=(n-l/r)/n),e+(i-s*c)/r-i}function x(e,t){I.forEach(function(r){return function e(t,r,n){n||(t.pins.length=t.pins.offset=0);var o,i,s,a,c,u,f,d,p=t.pins,g=t.markers;for(f=0;f<r.length;f++)if(d=r[f],t.trigger&&d.trigger&&t!==d&&(d.trigger===t.trigger||d.pinnedContainer===t.trigger||t.trigger.contains(d.trigger))&&(c=d._startNative||d._startClamp||d.start,u=d._endNative||d._endClamp||d.end,s=C(c,t),a=d.pin&&0<u?s+(u-c):C(u,t),d.setPositions(s,a,!0,(d._startClamp?Math.max(0,s):s)-c),d.markerStart&&g.push(l.quickSetter([d.markerStart,d.markerEnd],"y","px")),d.pin&&0<d.end&&!n)){if(o=d.end-d.start,i=t._startClamp&&d.start<0){if(0<t.start)return t.setPositions(0,t.end+(t._startNative-t.start),!0),void e(t,r);o+=d.start,p.offset=-d.start}p.push({start:d.start,nativeStart:c,end:d.end,distance:o,trig:d}),t.setPositions(t.start,t.end+(i?-d.start:o),!0)}}(r,e,t)})}function E(){n(),requestAnimationFrame(n),I&&($.getAll().forEach(function(e){e._startNative=e.start,e._endNative=e.end}),I.forEach(function(e){var t=e._startClamp||e.start,r=e.autoSpeed?Math.min(o(),e.end):t+Math.abs((e.end-t)/e.ratio),n=r-e.end;if((r-=n/2)<(t-=n/2)){var i=t;t=r,r=i}e._startClamp&&t<0?(n=(r=e.ratio<0?o():e.end/e.ratio)-e.end,t=0):(e.ratio<0||e._endClamp&&r>=o())&&(n=((r=o())-(t=e.ratio<0||1<e.ratio?0:r-(r-e.start)/e.ratio))*e.ratio-(e.end-e.start)),e.offset=n||1e-4,e.pins.length=e.pins.offset=0,e.setPositions(t,r,!0)}),x($.sort())),ec.reset()}function P(){return $.addEventListener("refresh",E)}function k(){return I&&I.forEach(function(e){return e.vars.onRefresh(e)})}function R(){return I&&I.forEach(function(e){return e.vars.onRefreshInit(e)}),k}function A(e,t,r,n){return function(){var o="function"==typeof t?t(r,n):t;o||0===o||(o=n.getAttribute("data-"+er+e)||("speed"===e?1:0)),n.setAttribute("data-"+er+e,o);var i="clamp("===(o+"").substr(0,6);return{clamp:i,value:i?o.substr(6,o.length-7):o}}}function z(e,t,r,n,i){function s(){t=b(),r=parseFloat(w().value),f=parseFloat(t.value)||1,y=(g="auto"===t.value)||p&&p._startClamp&&p.start<=0||C.offset?0:p&&p._endClamp&&p.end===o()?1:.5,v&&v.kill(),v=r&&l.to(e,{ease:m,overwrite:!1,y:"+=0",duration:r}),p&&(p.ratio=f,p.autoSpeed=g)}function a(){T.y=S+"px",T.renderTransform(1),s()}function c(t){if(g){a();var r,n,o,i,s,l,c,p,$,m,y,b=(r=e,n=h(0,1,-t.start/(t.end-t.start)),s=r.parentNode||d,l=r.getBoundingClientRect(),p=(c=s.getBoundingClientRect()).top-l.top,y=-(m=(Math.abs(p)>Math.abs($=c.bottom-l.bottom)?p:$)/(1-n))*n,0<m&&(i=.5==(o=c.height/(u.innerHeight+c.height))?2*c.height:2*Math.min(c.height,Math.abs(-m*o/(2*o-1)))*(n||1),y+=n?-i*n:-i/2,m+=i),{change:m,offset:y});E=b.change,_=b.offset}else _=C.offset||0,E=(t.end-t.start-_)*(1-f);C.forEach(function(e){return E-=e.distance*(1-f)}),t.offset=E||.001,t.vars.onUpdate(t),v&&v.progress(1)}i=("function"==typeof i?i(n,e):i)||0;var f,p,g,v,y,_,b=A("speed",t,n,e),w=A("lag",r,n,e),S=l.getProperty(e,"y"),T=e._gsap,C=[],x=[],E=0;return s(),(1!==f||g||v)&&(c(p=$.create({trigger:g?e.parentNode:e,start:function e(){return t.clamp?"clamp(top bottom+="+i+")":"top bottom+="+i},end:function e(){return t.value<0?"max":t.clamp?"clamp(bottom top-="+i+")":"bottom top-="+i},scroller:H,scrub:!0,refreshPriority:-999,onRefreshInit:a,onRefresh:c,onKill:function e(t){var r=I.indexOf(t);0<=r&&I.splice(r,1),a()},onUpdate:function e(t){var r,n,o,i,s=S+E*(t.progress-y),a=C.length,c=0;if(t.offset){if(a){for(o=-es,i=t.end;a--;){if((n=C[a]).trig.isActive||o>=n.start&&o<=n.end)return void(v&&(n.trig.progress+=n.trig.direction<0?.001:-.001,n.trig.update(0,0,1),v.resetTo("y",parseFloat(T.y),-ea,!0),el&&v.progress(1)));o>n.end&&(c+=n.distance),i-=n.distance}s=S+c+E*((l.utils.clamp(t.start,t.end,o)-t.start-c)/(i-t.start)-y)}x.length&&!g&&x.forEach(function(e){return e(s-c)}),s=Math.round(1e5*(r=s+_))/1e5||0,v?(v.resetTo("y",s,-ea,!0),el&&v.progress(1)):(T.y=s+"px",T.renderTransform(1))}}})),l.core.getCache(p.trigger).stRevert=R,p.startY=S,p.pins=C,p.markers=x,p.ratio=f,p.autoSpeed=g,e.style.willChange="transform"),p}c||T.register(l)||console.warn("Please gsap.registerPlugin(ScrollSmoother)"),e=this.vars=e||{},v&&v.kill(),b(v=this);var B,H,N,L,I,U,V,D,M,O,q,F,Y,j,K,W=e.smoothTouch,G=e.onUpdate,J=e.onStop,Q=e.smooth,X=e.onFocusIn,Z=e.normalizeScroll,ee=e.wholePixels,et=this,er=e.effectsPrefix||"",en=$.getScrollFunc(u),eo=1===$.isTouch?!0===W?.8:parseFloat(W)||0:0===Q||!1===Q?0:parseFloat(Q)||.8,ei=eo&&+e.speed||1,es=0,ea=0,el=1,ec=y(0),eu={y:0},ef="undefined"!=typeof ResizeObserver&&!1!==e.autoResize&&new ResizeObserver(function(){if(!$.isRefreshing){var e=o(H)*ei;e<-es&&a(e),w.restart(!0)}});function ed(){return N=B.clientHeight,B.style.overflow="visible",p.style.height=u.innerHeight+(N-u.innerHeight)/ei+"px",N-u.innerHeight}P(),$.addEventListener("killAll",P),l.delayedCall(.5,function(){return el=0}),this.scrollTop=a,this.scrollTo=function(e,r,n){var i=l.utils.clamp(0,o(),isNaN(e)?t.offset(e,n):+e);r?O?l.to(t,{duration:eo,scrollTop:i,overwrite:"auto",ease:m}):en(i):a(i)},this.offset=function(e,t){var r,n=(e=g(e)[0]).style.cssText,o=$.create({trigger:e,start:t||"top top"});return I&&(el?$.refresh():x([o],!0)),r=o.start/ei,o.kill(!1),e.style.cssText=n,l.core.getCache(e).uncache=1,r},this.content=function(e){if(arguments.length){var t=g(e||"#smooth-content")[0]||console.warn("ScrollSmoother needs a valid content element.")||p.children[0];return t!==B&&(M=(B=t).getAttribute("style")||"",ef&&ef.observe(B),l.set(B,{overflow:"visible",width:"100%",boxSizing:"border-box",y:"+=0"}),eo||l.set(B,{clearProps:"transform"})),this}return B},this.wrapper=function(e){var t,r;return arguments.length?(D=(H=g(e||"#smooth-wrapper")[0]||(t=B,(r=f.querySelector(".ScrollSmoother-wrapper"))||((r=f.createElement("div")).classList.add("ScrollSmoother-wrapper"),t.parentNode.insertBefore(r,t),r.appendChild(t)),r)).getAttribute("style")||"",ed(),l.set(H,eo?{overflow:"hidden",position:"fixed",height:"100%",width:"100%",top:0,left:0,right:0,bottom:0}:{overflow:"visible",position:"relative",width:"100%",height:"auto",top:"auto",bottom:"auto",left:"auto",right:"auto"}),this):H},this.effects=function(e,t){if(I=I||[],!e)return I.slice(0);(e=g(e)).forEach(function(e){for(var t=I.length;t--;)I[t].trigger===e&&I[t].kill()});var r,n,o=(t=t||{}).speed,i=t.lag,s=t.effectsPadding,a=[];for(r=0;r<e.length;r++)(n=z(e[r],o,i,r,s))&&a.push(n);return I.push.apply(I,a),a},this.sections=function(e,t){if(U=U||[],!e)return U.slice(0);var r=g(e).map(function(e){return $.create({trigger:e,start:"top 120%",end:"bottom -20%",onToggle:function t(r){e.style.opacity=r.isActive?"1":"0",e.style.pointerEvents=r.isActive?"all":"none"}})});return t&&t.add?U.push.apply(U,r):U=r.slice(0),r},this.content(e.content),this.wrapper(e.wrapper),this.render=function(e){return s(e||0===e?e:es)},this.getVelocity=function(){return ec.getVelocity(-es)},$.scrollerProxy(H,{scrollTop:a,scrollHeight:function e(){return ed()&&p.scrollHeight},fixedMarkers:!1!==e.fixedMarkers&&!!eo,content:B,getBoundingClientRect:function e(){return{top:0,left:0,width:u.innerWidth,height:u.innerHeight}}}),$.defaults({scroller:H});var ep=$.getAll().filter(function(e){return e.scroller===u||e.scroller===H});ep.forEach(function(e){return e.revert(!0,!0)}),L=$.create({animation:l.fromTo(eu,{y:0},{y:function e(){return-ed()},immediateRender:!1,ease:"none",data:"ScrollSmoother",duration:100,onUpdate:function e(){if(this._dur){var t=j;t&&(i(L),eu.y=es),s(eu.y,t),r(),G&&!O&&G(et)}}}),onRefreshInit:function e(t){if(!T.isRefreshing){if(T.isRefreshing=!0,I){var r=$.getAll().filter(function(e){return!!e.pin});I.forEach(function(e){e.vars.pinnedContainer||r.forEach(function(t){if(t.pin.contains(e.trigger)){var r=e.vars;r.pinnedContainer=t.pin,e.vars=null,e.init(r,e.animation)}})})}var n=t.getTween();Y=n&&n._end>n._dp._time,F=es,eu.y=0,eo&&(1===$.isTouch&&(H.style.position="absolute"),H.scrollTop=0,1===$.isTouch&&(H.style.position="fixed"))}},onRefresh:function e(t){t.animation.invalidate(),t.setPositions(t.start,ed()/ei),Y||i(t),eu.y=-en()*ei,s(eu.y),el||t.animation.progress(l.utils.clamp(0,1,-(F/ei/t.end))),Y&&(t.progress-=.001,t.update()),T.isRefreshing=!1},id:"ScrollSmoother",scroller:u,invalidateOnRefresh:!0,start:0,refreshPriority:-9999,end:function e(){return ed()/ei},onScrubComplete:function e(){ec.reset(),J&&J(t)},scrub:eo||!0}),this.smooth=function(t){return arguments.length&&(ei=(eo=t||0)&&+e.speed||1,L.scrubDuration(t)),L.getTween()?L.getTween().duration():0},L.getTween()&&(L.getTween().vars.ease=e.ease||m),this.scrollTrigger=L,e.effects&&this.effects(!0===e.effects?"[data-"+er+"speed], [data-"+er+"lag]":e.effects,{effectsPadding:e.effectsPadding}),e.sections&&this.sections(!0===e.sections?"[data-section]":e.sections),ep.forEach(function(e){e.vars.scroller=H,e.revert(!1,!0),e.init(e.vars,e.animation)}),this.paused=function(e,t){return arguments.length?(!!O!==e&&(e?(L.getTween()&&L.getTween().pause(),en(-es/ei),ec.reset(),(q=$.normalizeScroll())&&q.disable(),(O=$.observe({preventDefault:!0,type:"wheel,touch,scroll",debounce:!1,allowClicks:!0,onChangeY:function e(){return a(-es)}})).nested=_(d,"wheel,touch,scroll",!0,!1!==t)):(O.nested.kill(),O.kill(),O=0,q&&q.enable(),L.progress=(-es/ei-L.start)/(L.end-L.start),i(L))),this):!!O},this.kill=this.revert=function(){t.paused(!1),i(L),L.kill();for(var e=(I||[]).concat(U||[]),r=e.length;r--;)e[r].kill();$.scrollerProxy(H),$.removeEventListener("killAll",P),$.removeEventListener("refresh",E),H.style.cssText=D,B.style.cssText=M;var n=$.defaults({});n&&n.scroller===H&&$.defaults({scroller:u}),t.normalizer&&$.normalizeScroll(!1),clearInterval(V),v=null,ef&&ef.disconnect(),p.style.removeProperty("height"),u.removeEventListener("focusin",S)},this.refresh=function(e,t){return L.refresh(e,t)},Z&&(this.normalizer=$.normalizeScroll(!0===Z?{debounce:!0,content:!eo&&B}:Z)),$.config(e),"overscrollBehavior"in u.getComputedStyle(p)&&l.set([p,d],{overscrollBehavior:"none"}),"scrollBehavior"in u.getComputedStyle(p)&&l.set([p,d],{scrollBehavior:"auto"}),u.addEventListener("focusin",S),V=setInterval(r,250),"loading"===f.readyState||requestAnimationFrame(function(){return $.refresh()})}S.version="3.12.2",S.create=function(e){return v&&e&&v.content()===g(e.content)[0]?v:new S(e)},S.get=function(){return v},n()&&l.registerPlugin(S),e.ScrollSmoother=S,e.default=S,"undefined"==typeof window||window!==e?Object.defineProperty(e,"__esModule",{value:!0}):delete e.default});`}
        </Script>
      </body>
    </html>
  )
}

declare global {
  interface Window {
    ScrollSmoother: typeof ScrollSmoother
  }
}
